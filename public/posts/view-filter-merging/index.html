<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="generator" content="Hugo 0.151.2">

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="" />
  <meta property="og:url" content="http://localhost:1313/posts/view-filter-merging/" />
  <link rel="canonical" href="http://localhost:1313/posts/view-filter-merging/" /><link
    rel="alternate"
    type="application/atom+xml"
    href="http://localhost:1313/index.xml"
    title="guangluo&#39;s blog"
  />

  <script type="application/ld+json">
  {
      "@context" : "http://schema.org",
      "@type" : "BlogPosting",
      "mainEntityOfPage": {
           "@type": "WebPage",
           "@id": "http:\/\/localhost:1313\/"
      },
      "articleSection" : "posts",
      "name" : "VIEW_FILTER_MERGING",
      "headline" : "VIEW_FILTER_MERGING",
      "description" : "指定是否对视图条件进行优化以及如何优化。\n参数解析 属性：会话级（支持 HINT 指定） 缺省值：138\nVIEW_FILTER_MERGING 取不同值的效果如下：\n0：不进行视图合并； 1：尽可能地进行视图合并； 2：自动判断是否进行视图合并，以下两种条件则不进行视图合并： 视图在查询中出现次数多次且不是简单视图； 视图中包含过多的集合运算（\u0026gt;= 10），或待合并的过滤条件为复杂布尔表达式； 4：视图包含分析函数时，如果分析函数的 partition by 具有唯一性，则外层过滤条件会下推到视图内部； 8：如果派生表存在集函数，则不进行条件下推优化； 16：收集公用表达式相关的所有过滤条件，改写合并所有条件，并下放到公用表达式的内部； 32：TOP 信息下推到派生表； 64：外层布尔表达式隐式声明 IS NOT NULL 属性，对派生表\/视图对应的列显示添加 COL IS NOT NULL 布尔表达式； 128：外层 ROWNUM 过滤表达式尝试下放至视图\/派生表生成 TOP 子句； 256：当满足以下条件时，对相关派生表过滤条件进行下推优化： 过滤条件对应派生表的查询项，并且是查询表达式； 过滤条件列映射为查询表达式的引用列，并且引用列来自派生表的 FROM 项； 512：视图已经有过滤条件的，不重复下放，为了后续能使用 htab； 1024：包含该值时，取消下述限制： 视图是集合运算时的分支数应小于 10； 若视图是集合运算且超过 2 个分支时，过滤条件不能含有复杂函数\/表达式； 其实这个效果的表述问题有点多，有以下问题，这些问题都需要测试：\n当取值为 2 的时候，视图在查询中出现多少次才不会合并； 当取值为 2 的时候，简单视图需要多简单才不会合并； 当取值为 16 的时候，公用表达式是什么； 当取值为 64 的时候，如何隐式声明 IS NOT NULL 属性； 当取值为 256 的时候，查询项可以为标量子查询\/case when 这种查询项吗； 和 [[complex-view-merging]] 有什么区别； 原理解析 构造以下 SQL\n",
      "inLanguage" : "en-US",
      "author" : "",
      "creator" : "",
      "publisher": "",
      "accountablePerson" : "",
      "copyrightHolder" : "",
      "copyrightYear" : "2025",
      "datePublished": "2025-10-23 17:03:09 \u002b0800 CST",
      "dateModified" : "2025-10-23 17:03:09 \u002b0800 CST",
      "url" : "http:\/\/localhost:1313\/posts\/view-filter-merging\/",
      "keywords" : [  ]
  }
</script>
<title>VIEW_FILTER_MERGING</title>
  <meta property="og:title" content="VIEW_FILTER_MERGING" />
  <meta property="og:type" content="article" />
  <meta
    property="og:description"
    content="指定是否对视图条件进行优化以及如何优化。
参数解析 属性：会话级（支持 HINT 指定） 缺省值：138
VIEW_FILTER_MERGING 取不同值的效果如下：
0：不进行视图合并； 1：尽可能地进行视图合并； 2：自动判断是否进行视图合并，以下两种条件则不进行视图合并： 视图在查询中出现次数多次且不是简单视图； 视图中包含过多的集合运算（&gt;= 10），或待合并的过滤条件为复杂布尔表达式； 4：视图包含分析函数时，如果分析函数的 partition by 具有唯一性，则外层过滤条件会下推到视图内部； 8：如果派生表存在集函数，则不进行条件下推优化； 16：收集公用表达式相关的所有过滤条件，改写合并所有条件，并下放到公用表达式的内部； 32：TOP 信息下推到派生表； 64：外层布尔表达式隐式声明 IS NOT NULL 属性，对派生表/视图对应的列显示添加 COL IS NOT NULL 布尔表达式； 128：外层 ROWNUM 过滤表达式尝试下放至视图/派生表生成 TOP 子句； 256：当满足以下条件时，对相关派生表过滤条件进行下推优化： 过滤条件对应派生表的查询项，并且是查询表达式； 过滤条件列映射为查询表达式的引用列，并且引用列来自派生表的 FROM 项； 512：视图已经有过滤条件的，不重复下放，为了后续能使用 htab； 1024：包含该值时，取消下述限制： 视图是集合运算时的分支数应小于 10； 若视图是集合运算且超过 2 个分支时，过滤条件不能含有复杂函数/表达式； 其实这个效果的表述问题有点多，有以下问题，这些问题都需要测试：
当取值为 2 的时候，视图在查询中出现多少次才不会合并； 当取值为 2 的时候，简单视图需要多简单才不会合并； 当取值为 16 的时候，公用表达式是什么； 当取值为 64 的时候，如何隐式声明 IS NOT NULL 属性； 当取值为 256 的时候，查询项可以为标量子查询/case when 这种查询项吗； 和 [[complex-view-merging]] 有什么区别； 原理解析 构造以下 SQL
"
  />
  <meta
    name="description"
    content="指定是否对视图条件进行优化以及如何优化。
参数解析 属性：会话级（支持 HINT 指定） 缺省值：138
VIEW_FILTER_MERGING 取不同值的效果如下：
0：不进行视图合并； 1：尽可能地进行视图合并； 2：自动判断是否进行视图合并，以下两种条件则不进行视图合并： 视图在查询中出现次数多次且不是简单视图； 视图中包含过多的集合运算（&gt;= 10），或待合并的过滤条件为复杂布尔表达式； 4：视图包含分析函数时，如果分析函数的 partition by 具有唯一性，则外层过滤条件会下推到视图内部； 8：如果派生表存在集函数，则不进行条件下推优化； 16：收集公用表达式相关的所有过滤条件，改写合并所有条件，并下放到公用表达式的内部； 32：TOP 信息下推到派生表； 64：外层布尔表达式隐式声明 IS NOT NULL 属性，对派生表/视图对应的列显示添加 COL IS NOT NULL 布尔表达式； 128：外层 ROWNUM 过滤表达式尝试下放至视图/派生表生成 TOP 子句； 256：当满足以下条件时，对相关派生表过滤条件进行下推优化： 过滤条件对应派生表的查询项，并且是查询表达式； 过滤条件列映射为查询表达式的引用列，并且引用列来自派生表的 FROM 项； 512：视图已经有过滤条件的，不重复下放，为了后续能使用 htab； 1024：包含该值时，取消下述限制： 视图是集合运算时的分支数应小于 10； 若视图是集合运算且超过 2 个分支时，过滤条件不能含有复杂函数/表达式； 其实这个效果的表述问题有点多，有以下问题，这些问题都需要测试：
当取值为 2 的时候，视图在查询中出现多少次才不会合并； 当取值为 2 的时候，简单视图需要多简单才不会合并； 当取值为 16 的时候，公用表达式是什么； 当取值为 64 的时候，如何隐式声明 IS NOT NULL 属性； 当取值为 256 的时候，查询项可以为标量子查询/case when 这种查询项吗； 和 [[complex-view-merging]] 有什么区别； 原理解析 构造以下 SQL
"
  />
  <meta property="og:locale" content="en-us" /><meta property="og:image" content="" />
  
  
  <style>body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:#000;text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:#000}.markdown-body blockquote{margin:0;padding:0 1em;color:#57606a;border-left:.25em solid #d0d7de}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:#f6f8fa;border-radius:6px}.markdown-body pre>code{padding:0;font-size:100%;background-color:inherit;border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:#666}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:#482936;border-style:solid none none none}.lang-switch{font-weight:600}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:#000 2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:#000 2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:6px}.post-content .post-gallery{display:flex;flex-wrap:wrap;gap:6px}.post-content .post-gallery img{margin-right:auto;margin-top:auto;width:calc(50% - 3px)}.related-content{border-width:3px;border-style:solid;border-color:#000;padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:#fff}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}.post-content .post-gallery img{width:100%}}@media screen and (max-width:48em){.posts-category{display:none}}</style>
  
  
  <style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style>
  
   <link href="/index.xml" rel="alternate" type="application/rss+xml" title="guangluo&#39;s blog">
  
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link
    href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade"
    rel="stylesheet"
  />
  
  

  
  
</head>


<body>
  <article class="post " id="article">
    <div class="row">
      <div class="col-xs-12">
        <div class="site-header">
          
<header>
  <div class="header-title">
    <a href="/"
      >Guang Luo</a
    >
  </div>
  <div class="header-subtitle"></div>
</header>
<div class="row end-md header-items">
  
  <div class="header-item">
    <a href="https://github.com/guangluo" target="_blank">Github</a>
  </div>
  
</div>
<div class="row">
   
</div>
<div class="header-line"></div>

        </div>
        <header class="post-header">
          <h1 class="post-title">VIEW_FILTER_MERGING</h1>
          
          <div class="row post-desc">
            <div class="col-xs-6">
              
              <time class="post-date" datetime="2025-10-23 17:03:09 CST">
                23 Oct 2025
              </time>
              
            </div>
            <div class="col-xs-6">
              
            </div>
          </div>
          
        </header>

        <div class="post-content markdown-body">
          
          <p>指定是否对视图条件进行优化以及如何优化。</p>
<h2 id="参数解析">参数解析</h2>
<p><strong>属性</strong>：会话级（支持 HINT 指定）
<strong>缺省值</strong>：138</p>
<p><code>VIEW_FILTER_MERGING</code> 取不同值的效果如下：</p>
<ul>
<li>0：不进行视图合并；</li>
<li>1：尽可能地进行视图合并；</li>
<li>2：自动判断是否进行视图合并，以下两种条件则不进行视图合并：
<ul>
<li>视图在查询中出现次数多次且不是简单视图；</li>
<li>视图中包含过多的集合运算（&gt;= 10），或待合并的过滤条件为复杂布尔表达式；</li>
</ul>
</li>
<li>4：视图包含分析函数时，如果分析函数的 <code>partition by</code> 具有唯一性，则外层过滤条件会下推到视图内部；</li>
<li>8：如果派生表存在集函数，则不进行条件下推优化；</li>
<li>16：收集公用表达式相关的所有过滤条件，改写合并所有条件，并下放到公用表达式的内部；</li>
<li>32：<code>TOP</code> 信息下推到派生表；</li>
<li>64：外层布尔表达式隐式声明 <code>IS NOT NULL</code> 属性，对派生表/视图对应的列显示添加 <code>COL IS NOT NULL</code> 布尔表达式；</li>
<li>128：外层 <code>ROWNUM</code> 过滤表达式尝试下放至视图/派生表生成 <code>TOP</code> 子句；</li>
<li>256：当满足以下条件时，对相关派生表过滤条件进行下推优化：
<ul>
<li>过滤条件对应派生表的查询项，并且是查询表达式；</li>
<li>过滤条件列映射为查询表达式的引用列，并且引用列来自派生表的 <code>FROM</code> 项；</li>
</ul>
</li>
<li>512：视图已经有过滤条件的，不重复下放，为了后续能使用 <code>htab</code>；</li>
<li>1024：包含该值时，取消下述限制：
<ul>
<li>视图是集合运算时的分支数应小于 10；</li>
<li>若视图是集合运算且超过 2 个分支时，过滤条件不能含有复杂函数/表达式；</li>
</ul>
</li>
</ul>
<p>其实这个效果的表述问题有点多，有以下问题，这些问题都需要测试：</p>
<ol>
<li>当取值为 2 的时候，视图在查询中出现多少次才不会合并；</li>
<li>当取值为 2 的时候，简单视图需要多简单才不会合并；</li>
<li>当取值为 16 的时候，公用表达式是什么；</li>
<li>当取值为 64 的时候，如何隐式声明 <code>IS NOT NULL</code> 属性；</li>
<li>当取值为 256 的时候，查询项可以为标量子查询/case when 这种查询项吗；</li>
<li>和 [[complex-view-merging]] 有什么区别；</li>
</ol>
<h2 id="原理解析">原理解析</h2>
<p>构造以下 SQL</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">CREATE</span> <span style="font-weight:bold">TABLE</span> TEST_LG1 ( A1 INT, B1 VARCHAR(255) );
</span></span><span style="display:flex;"><span><span style="font-weight:bold">CREATE</span> <span style="font-weight:bold">TABLE</span> TEST_LG2 ( A2 INT, B2 VARCHAR(255) );
</span></span><span style="display:flex;"><span><span style="font-weight:bold">CREATE</span> <span style="font-weight:bold">TABLE</span> TEST_LG3 ( A3 INT, B3 VARCHAR(255) );
</span></span><span style="display:flex;"><span><span style="font-weight:bold">CREATE</span> <span style="font-weight:bold">TABLE</span> TEST_LG4 ( A4 INT, B4 VARCHAR(255) );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">INSERT</span> <span style="font-weight:bold">INTO</span> TEST_LG1 <span style="font-weight:bold">SELECT</span> <span style="font-weight:bold">LEVEL</span>,<span style="font-weight:bold">LEVEL</span> <span style="font-weight:bold">FROM</span> DUAL <span style="font-weight:bold">CONNECT</span> <span style="font-weight:bold">BY</span> <span style="font-weight:bold">LEVEL</span> &lt;= 100000;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">INSERT</span> <span style="font-weight:bold">INTO</span> TEST_LG2 <span style="font-weight:bold">SELECT</span> <span style="font-weight:bold">LEVEL</span>,<span style="font-weight:bold">LEVEL</span> <span style="font-weight:bold">FROM</span> DUAL <span style="font-weight:bold">CONNECT</span> <span style="font-weight:bold">BY</span> <span style="font-weight:bold">LEVEL</span> &lt;= 100000;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">INSERT</span> <span style="font-weight:bold">INTO</span> TEST_LG3 <span style="font-weight:bold">SELECT</span> <span style="font-weight:bold">LEVEL</span>,<span style="font-weight:bold">LEVEL</span> <span style="font-weight:bold">FROM</span> DUAL <span style="font-weight:bold">CONNECT</span> <span style="font-weight:bold">BY</span> <span style="font-weight:bold">LEVEL</span> &lt;= 100000;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">INSERT</span> <span style="font-weight:bold">INTO</span> TEST_LG4 <span style="font-weight:bold">SELECT</span> <span style="font-weight:bold">LEVEL</span>,<span style="font-weight:bold">LEVEL</span> <span style="font-weight:bold">FROM</span> DUAL <span style="font-weight:bold">CONNECT</span> <span style="font-weight:bold">BY</span> <span style="font-weight:bold">LEVEL</span> &lt;= 100000;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">CREATE</span> <span style="font-weight:bold">OR</span> <span style="font-weight:bold">REPLACE</span> <span style="font-weight:bold">VIEW</span> V_TEST_LG(A,B) <span style="font-weight:bold">AS</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">SELECT</span> A1,B1 <span style="font-weight:bold">FROM</span> TEST_LG1 <span style="font-weight:bold">WHERE</span> A1 = 1
</span></span><span style="display:flex;"><span><span style="font-weight:bold">UNION</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">SELECT</span> A2,B2 <span style="font-weight:bold">FROM</span> TEST_LG2 <span style="font-weight:bold">WHERE</span> A2 = 1 <span style="font-weight:bold">AND</span> B2 = 2
</span></span><span style="display:flex;"><span><span style="font-weight:bold">UNION</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">SELECT</span> A3,B3 <span style="font-weight:bold">FROM</span> TEST_LG3 <span style="font-weight:bold">WHERE</span> A3 &gt; 5
</span></span><span style="display:flex;"><span><span style="font-weight:bold">UNION</span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">SELECT</span> A4,B4 <span style="font-weight:bold">FROM</span> TEST_LG4 <span style="font-weight:bold">WHERE</span> B4 &lt; 5;
</span></span></code></pre></div><h3 id="值为-0">值为 0</h3>
<p>不进行视图合并。</p>
<p>此时查看以下 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">EXPLAIN</span> <span style="font-weight:bold">SELECT</span> <span style="font-style:italic">/*+VIEW_FILTER_MERGING(0) COMPLEX_VIEW_MERGING(0)*/</span> * <span style="font-weight:bold">FROM</span> V_TEST_LG <span style="font-weight:bold">WHERE</span> A = 1;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [56, 3, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [56, 3, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #SLCT2: [56, 3, 52]; V_TEST_LG.A = 1
</span></span><span style="display:flex;"><span>4         #PRJT2: [56, 126, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>5           #DISTINCT: [56, 126, 52]
</span></span><span style="display:flex;"><span>6             #UNION ALL: [55, 12625, 52]
</span></span><span style="display:flex;"><span>7               #PRJT2: [40, 7625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>8                 #UNION ALL: [40, 7625, 52]
</span></span><span style="display:flex;"><span>9                   #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>10                    #UNION ALL: [26, 2625, 52]
</span></span><span style="display:flex;"><span>11                      #PRJT2: [12, 2500, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>12                        #SLCT2: [12, 2500, 52]; TEST_LG1.A1 = 1
</span></span><span style="display:flex;"><span>13                          #CSCN2: [12, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>14                      #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>15                        #SLCT2: [12, 125, 52]; (TEST_LG2.A2 = 1 AND exp_cast(TEST_LG2.B2) = 2)
</span></span><span style="display:flex;"><span>16                          #CSCN2: [12, 100000, 52]; INDEX33555468(TEST_LG2); btr_scan(1)
</span></span><span style="display:flex;"><span>17                  #PRJT2: [12, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>18                    #SLCT2: [12, 5000, 52]; TEST_LG3.A3 &gt; 5
</span></span><span style="display:flex;"><span>19                      #CSCN2: [12, 100000, 52]; INDEX33555469(TEST_LG3); btr_scan(1)
</span></span><span style="display:flex;"><span>20              #PRJT2: [12, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>21                #SLCT2: [12, 5000, 52]; exp_cast(TEST_LG4.B4) &lt; 5
</span></span><span style="display:flex;"><span>22                  #CSCN2: [12, 100000, 52]; INDEX33555470(TEST_LG4); btr_scan(1)
</span></span></code></pre></div><p>此时 <code>SLCT2</code> 并没有下放到视图内，执行计划也就是正常的情况，先把 <code>select * from v_test_lg</code> 查询出来，然后再进行过滤。</p>
<h3 id="值为-1">值为 1</h3>
<p>尽可能地进行视图合并。</p>
<p>此时继续查看以下 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">EXPLAIN</span> <span style="font-weight:bold">SELECT</span> <span style="font-style:italic">/*+VIEW_FILTER_MERGING(1) COMPLEX_VIEW_MERGING(0)*/</span> * <span style="font-weight:bold">FROM</span> V_TEST_LG <span style="font-weight:bold">WHERE</span> A = 1;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [41, 27, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [41, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [41, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #DISTINCT: [41, 27, 52]
</span></span><span style="display:flex;"><span>5           #UNION ALL: [40, 2750, 52]
</span></span><span style="display:flex;"><span>6             #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>7               #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>8                 #UNION ALL: [26, 2625, 52]
</span></span><span style="display:flex;"><span>9                   #PRJT2: [12, 2500, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>10                    #SLCT2: [12, 2500, 52]; TEST_LG1.A1 = 1
</span></span><span style="display:flex;"><span>11                      #CSCN2: [12, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>12                  #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>13                    #SLCT2: [12, 125, 52]; (TEST_LG2.A2 = 1 AND exp_cast(TEST_LG2.B2) = 2)
</span></span><span style="display:flex;"><span>14                      #CSCN2: [12, 100000, 52]; INDEX33555468(TEST_LG2); btr_scan(1)
</span></span><span style="display:flex;"><span>15            #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>16              #SLCT2: [12, 125, 52]; (TEST_LG4.A4 = 1 AND exp_cast(TEST_LG4.B4) &lt; 5)
</span></span><span style="display:flex;"><span>17                #CSCN2: [12, 100000, 52]; INDEX33555470(TEST_LG4); btr_scan(1)
</span></span></code></pre></div><p>这个时候会把 <code>where a = 1</code> 下推到视图中每一个查询里。
可以看到少了对 <code>TEST_LG3</code> 表的查询，这是因为 <code>TEST_LG3</code> 的查询项 <code>A3 &gt; 5 AND A3 = 1</code> 必定为 false，所以直接把 <code>TEST_LG3</code> 裁剪了。</p>
<h3 id="值为-2">值为 2</h3>
<p>自动判断是否进行视图合并，以下两种条件则不进行视图合并：</p>
<ul>
<li>视图在查询中出现次数多次且不是简单视图；</li>
<li>视图中包含过多的集合运算（&gt;= 10），或待合并的过滤条件为复杂布尔表达式；</li>
</ul>
<p>以下是不进行视图合并的情况</p>
<ul>
<li>视图被查询多次的时候，无法进行视图合并</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>  <span style="font-style:italic">/*+view_filter_merging(2) complex_view_merging(0)*/</span>
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>  (
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> v_test_lg
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> v_test_lg
</span></span><span style="display:flex;"><span>  ) t
</span></span><span style="display:flex;"><span><span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>  t.a = 1;
</span></span></code></pre></div><p>此时的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [111, 55, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [111, 55, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [111, 55, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #UNION ALL: [111, 55, 52]
</span></span><span style="display:flex;"><span>5           #PRJT2: [55, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>6             #PRJT2: [55, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>7               #DISTINCT: [55, 27, 52]
</span></span><span style="display:flex;"><span>8                 #UNION ALL: [54, 2751, 52]
</span></span><span style="display:flex;"><span>9                   #PRJT2: [40, 2626, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>10                    #UNION ALL: [40, 2626, 52]
</span></span><span style="display:flex;"><span>11                      #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>12                        #UNION ALL: [26, 2625, 52]
</span></span><span style="display:flex;"><span>13                          #PRJT2: [12, 2500, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>14                            #SLCT2: [12, 2500, 52]; TEST_LG1.A1 = 1
</span></span><span style="display:flex;"><span>15                              #CSCN2: [12, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>16                          #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>17                            #SLCT2: [12, 125, 52]; (TEST_LG2.A2 = 1 AND exp_cast(TEST_LG2.B2) = 2)
</span></span><span style="display:flex;"><span>18                              #CSCN2: [12, 100000, 52]; INDEX33555468(TEST_LG2); btr_scan(1)
</span></span><span style="display:flex;"><span>19                      #PRJT2: [12, 1, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>20                        #SLCT2: [12, 1, 52]; 1 &gt; 5
</span></span><span style="display:flex;"><span>21                          #CSCN2: [12, 100000, 52]; INDEX33555469(TEST_LG3); btr_scan(1)
</span></span><span style="display:flex;"><span>22                  #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>23                    #SLCT2: [12, 125, 52]; (exp_cast(TEST_LG4.B4) &lt; 5 AND TEST_LG4.A4 = 1)
</span></span><span style="display:flex;"><span>24                      #CSCN2: [12, 100000, 52]; INDEX33555470(TEST_LG4); btr_scan(1)
</span></span><span style="display:flex;"><span>25          #PRJT2: [55, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>26            #PRJT2: [55, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>27              #DISTINCT: [55, 27, 52]
</span></span><span style="display:flex;"><span>28                #UNION ALL: [54, 2751, 52]
</span></span><span style="display:flex;"><span>29                  #PRJT2: [40, 2626, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>30                    #UNION ALL: [40, 2626, 52]
</span></span><span style="display:flex;"><span>31                      #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>32                        #UNION ALL: [26, 2625, 52]
</span></span><span style="display:flex;"><span>33                          #PRJT2: [12, 2500, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>34                            #SLCT2: [12, 2500, 52]; TEST_LG1.A1 = 1
</span></span><span style="display:flex;"><span>35                              #CSCN2: [12, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>36                          #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>37                            #SLCT2: [12, 125, 52]; (TEST_LG2.A2 = 1 AND exp_cast(TEST_LG2.B2) = 2)
</span></span><span style="display:flex;"><span>38                              #CSCN2: [12, 100000, 52]; INDEX33555468(TEST_LG2); btr_scan(1)
</span></span><span style="display:flex;"><span>39                      #PRJT2: [12, 1, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>40                        #SLCT2: [12, 1, 52]; 1 &gt; 5
</span></span><span style="display:flex;"><span>41                          #CSCN2: [12, 100000, 52]; INDEX33555469(TEST_LG3); btr_scan(1)
</span></span><span style="display:flex;"><span>42                  #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>43                    #SLCT2: [12, 125, 52]; (exp_cast(TEST_LG4.B4) &lt; 5 AND TEST_LG4.A4 = 1)
</span></span><span style="display:flex;"><span>44                      #CSCN2: [12, 100000, 52]; INDEX33555470(TEST_LG4); btr_scan(1)
</span></span></code></pre></div><p> 可以看到 <code>TEST_LG3</code> 是没有被裁剪的，再看此 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>  <span style="font-style:italic">/*+view_filter_merging(2) complex_view_merging(0)*/</span>
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>  ( <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> v_test_lg ) t
</span></span><span style="display:flex;"><span><span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>  t.a = 1;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [41, 27, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [41, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [41, 27, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #DISTINCT: [41, 27, 52]
</span></span><span style="display:flex;"><span>5           #UNION ALL: [40, 2750, 52]
</span></span><span style="display:flex;"><span>6             #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>7               #PRJT2: [26, 2625, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>8                 #UNION ALL: [26, 2625, 52]
</span></span><span style="display:flex;"><span>9                   #PRJT2: [12, 2500, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>10                    #SLCT2: [12, 2500, 52]; TEST_LG1.A1 = 1
</span></span><span style="display:flex;"><span>11                      #CSCN2: [12, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>12                  #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>13                    #SLCT2: [12, 125, 52]; (TEST_LG2.A2 = 1 AND exp_cast(TEST_LG2.B2) = 2)
</span></span><span style="display:flex;"><span>14                      #CSCN2: [12, 100000, 52]; INDEX33555468(TEST_LG2); btr_scan(1)
</span></span><span style="display:flex;"><span>15            #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>16              #SLCT2: [12, 125, 52]; (TEST_LG4.A4 = 1 AND exp_cast(TEST_LG4.B4) &lt; 5)
</span></span><span style="display:flex;"><span>17                #CSCN2: [12, 100000, 52]; INDEX33555470(TEST_LG4); btr_scan(1)
</span></span></code></pre></div><p>此时 <code>TEST_LG3</code> 是被裁剪的。
可以说明，<strong>如果 <code>V_TEST_LG</code> 被查询多次之后，没有办法进行视图合并。</strong></p>
<ul>
<li>过滤条件为复杂表达式时，无法合并视图</li>
</ul>
<p>查看以下 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>  <span style="font-style:italic">/*+view_filter_merging(2) complex_view_merging(0)*/</span>
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>  (
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>      *
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>      v_test_lg
</span></span><span style="display:flex;"><span>  ) t
</span></span><span style="display:flex;"><span><span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>  t.a || <span style="font-style:italic">&#39;1&#39;</span> || t.b = <span style="font-style:italic">&#39;111&#39;</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [54, 3, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [54, 3, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [54, 3, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #DISTINCT: [54, 3, 52]
</span></span><span style="display:flex;"><span>5           #UNION ALL: [53, 315, 52]
</span></span><span style="display:flex;"><span>6             #PRJT2: [39, 190, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>7               #UNION ALL: [39, 190, 52]
</span></span><span style="display:flex;"><span>8                 #PRJT2: [26, 65, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>9                   #UNION ALL: [26, 65, 52]
</span></span><span style="display:flex;"><span>10                    #PRJT2: [12, 62, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>11                      #SLCT2: [12, 62, 52]; (TEST_LG1.A1 = 1 AND var3 || TEST_LG1.B1 = &#39;111&#39;)
</span></span><span style="display:flex;"><span>12                        #CSCN2: [12, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>13                    #PRJT2: [12, 3, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>14                      #SLCT2: [12, 3, 52]; (TEST_LG2.A2 = 1 AND var6 || TEST_LG2.B2 = &#39;111&#39; AND exp_cast(TEST_LG2.B2) = 2)
</span></span><span style="display:flex;"><span>15                        #CSCN2: [12, 100000, 52]; INDEX33555468(TEST_LG2); btr_scan(1)
</span></span><span style="display:flex;"><span>16                #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>17                  #SLCT2: [12, 125, 52]; (TEST_LG3.A3 &gt; 5 AND exp_cast(exp_cast(TEST_LG3.A3) || &#39;1&#39;) || TEST_LG3.B3 = &#39;111&#39;)
</span></span><span style="display:flex;"><span>18                    #CSCN2: [12, 100000, 52]; INDEX33555469(TEST_LG3); btr_scan(1)
</span></span><span style="display:flex;"><span>19            #PRJT2: [12, 125, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>20              #SLCT2: [12, 125, 52]; (exp_cast(TEST_LG4.B4) &lt; 5 AND exp_cast(exp_cast(TEST_LG4.A4) || &#39;1&#39;) || TEST_LG4.B4 = &#39;111&#39;)
</span></span><span style="display:flex;"><span>21                #CSCN2: [12, 100000, 52]; INDEX33555470(TEST_LG4); btr_scan(1)
</span></span></code></pre></div><p>此时 <code>TEST_LG3</code> 也没有进行裁剪。</p>
<h3 id="值为-4">值为 4</h3>
<p>视图包含分析函数时，如果分析函数的 <code>partition by</code> 具有唯一性，则外层过滤条件会下推到视图内部。</p>
<p>为了确保分析函数的 <code>partition by</code> 具有唯一性，给 <code>test_lg1</code> 建立一条唯一索引</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">create</span> <span style="font-weight:bold">unique</span> <span style="font-weight:bold">index</span> idx_test_lg1_a1 <span style="font-weight:bold">on</span> test_lg1(a1);
</span></span></code></pre></div><p>再看一下这条 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>  (
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>      b1,
</span></span><span style="display:flex;"><span>      row_number() over (
</span></span><span style="display:flex;"><span>        partition <span style="font-weight:bold">by</span> a1
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">order</span> <span style="font-weight:bold">by</span>
</span></span><span style="display:flex;"><span>          b1
</span></span><span style="display:flex;"><span>      ) aa
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>      test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>      b1 &lt; <span style="font-style:italic">&#39;10&#39;</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span><span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>  b1 &gt; <span style="font-style:italic">&#39;1&#39;</span>;
</span></span></code></pre></div><p><code>view_filter_merging = 4</code> 的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [12, 3750, 64]
</span></span><span style="display:flex;"><span>2     #PRJT2: [12, 3750, 64]; exp_num(3), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [12, 3750, 64]; exp_num(3), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #AFUN: [12, 3750, 64]; afun_num(1); partition_num(1)[TEST_LG1.A1]; order_num(1)[TEST_LG1.B1]
</span></span><span style="display:flex;"><span>5           #SORT3: [12, 3750, 64]; key_num(2), partition_key_num(0), is_distinct(FALSE), top_flag(0), is_adaptive(0)
</span></span><span style="display:flex;"><span>6             #SLCT2: [12, 3750, 64]; (TEST_LG1.B1 &lt; &#39;10&#39; AND TEST_LG1.B1 &gt; &#39;1&#39;)
</span></span><span style="display:flex;"><span>7               #CSCN2: [12, 100000, 64]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span></code></pre></div><p><code>view_filter_merging = 0</code> 的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [13, 250, 64]
</span></span><span style="display:flex;"><span>2     #PRJT2: [13, 250, 64]; exp_num(3), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #SLCT2: [13, 250, 64]; DMTEMPVIEW_889193519.B1 &gt; &#39;1&#39;
</span></span><span style="display:flex;"><span>4         #PRJT2: [12, 5000, 64]; exp_num(3), is_atom(FALSE)
</span></span><span style="display:flex;"><span>5           #AFUN: [12, 5000, 64]; afun_num(1); partition_num(1)[TEST_LG1.A1]; order_num(1)[TEST_LG1.B1]
</span></span><span style="display:flex;"><span>6             #SORT3: [12, 5000, 64]; key_num(2), partition_key_num(0), is_distinct(FALSE), top_flag(0), is_adaptive(0)
</span></span><span style="display:flex;"><span>7               #SLCT2: [12, 5000, 64]; TEST_LG1.B1 &lt; &#39;10&#39;
</span></span><span style="display:flex;"><span>8                 #CSCN2: [12, 100000, 64]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span></code></pre></div><p>其实可以看到，<code>view_filter_merging = 0</code> 的执行计划多了一个 <code>SLCT2</code> 操作符，所以说，当 <code>view_filter_merging = 4</code> 的时候，条件是可以下推的，以此来减少数据页扫描的数量。</p>
<h3 id="值为-8">值为 8</h3>
<p>如果派生表存在集函数，则不进行条件下推优化。</p>
<p>查看以下 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> ( <span style="font-weight:bold">select</span> <span style="font-weight:bold">max</span>(c1),1 x <span style="font-weight:bold">from</span> t1 ) t <span style="font-weight:bold">where</span> x &gt; 5;
</span></span></code></pre></div><p><code>view_filter_merging(0)</code> 的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [1, 1, 4]
</span></span><span style="display:flex;"><span>2     #PRJT2: [1, 1, 4]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [1, 1, 4]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #AAGR2: [1, 1, 4]; grp_num(0), sfun_num(1), distinct_flag[0]; slave_empty(0)
</span></span><span style="display:flex;"><span>5           #SLCT2: [1, 1, 4];  FALSE
</span></span><span style="display:flex;"><span>6             #CSCN2: [1, 1, 4]; INDEX33555472(T1); btr_scan(1)
</span></span></code></pre></div><p>此时的 <code>SLCT2</code> 操作符很明显下推到了派生表中，他在 <code>PRJT2</code> 操作符下面。</p>
<p><code>view_filter_merging(8)</code> 的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [1, 1, 4]
</span></span><span style="display:flex;"><span>2     #PRJT2: [1, 1, 4]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #SLCT2: [1, 1, 4]; T.X &gt; 5
</span></span><span style="display:flex;"><span>4         #PRJT2: [1, 1, 4]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>5           #AAGR2: [1, 1, 4]; grp_num(0), sfun_num(1), distinct_flag[0]; slave_empty(0)
</span></span><span style="display:flex;"><span>6             #CSCN2: [1, 1, 4]; INDEX33555472(T1); btr_scan(1)
</span></span></code></pre></div><p>此时的 <code>SLCT2</code> 操作符在 <code>PRJT2</code> 操作符上面，所以是没有下推行为的。</p>
<h3 id="值为-16">值为 16</h3>
<ul>
<li><input disabled="" type="checkbox"> 文档例子有问题</li>
</ul>
<p>收集公用表达式相关的所有过滤条件，改写合并所有条件，并下放到公用表达式的内部。</p>
<h3 id="值为-32">值为 32</h3>
<p><code>TOP</code> 信息下推到派生表。</p>
<h3 id="值为-64">值为 64</h3>
<ul>
<li><input disabled="" type="checkbox"> 文档例子有问题</li>
</ul>
<p>外层布尔表达式隐式声明 <code>IS NOT NULL</code> 属性，对派生表/视图对应的列显示添加 <code>COL IS NOT NULL</code> 布尔表达式。</p>
<h3 id="值为-128">值为 128</h3>
<p>外层 <code>ROWNUM</code> 过滤表达式尝试下放至视图/派生表生成 <code>TOP</code> 子句。
查看以下 SQL 的执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>  (
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>      *,
</span></span><span style="display:flex;"><span>      rownum rn
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>      test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">order</span> <span style="font-weight:bold">by</span>
</span></span><span style="display:flex;"><span>      a1
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span><span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>  rn &lt; 10;
</span></span></code></pre></div><p><code>VIEW_FILTER_MERGING = 0</code> 时的计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [15, 5000, 64]
</span></span><span style="display:flex;"><span>2     #PRJT2: [15, 5000, 64]; exp_num(4), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #SLCT2: [15, 5000, 64]; DMTEMPVIEW_889193477.RN &lt; var1
</span></span><span style="display:flex;"><span>4         #PRJT2: [11, 100000, 64]; exp_num(4), is_atom(FALSE)
</span></span><span style="display:flex;"><span>5           #RN: [11, 100000, 64]
</span></span><span style="display:flex;"><span>6             #BLKUP2: [11, 100000, 64]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>7               #SSCN: [11, 100000, 64]; IDX_TEST_LG1_A1(TEST_LG1); btr_scan(1); is_global(0)
</span></span></code></pre></div><p><code>VIEW_FILTER_MERGING = 128</code> 时的计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [12, 9, 64]
</span></span><span style="display:flex;"><span>2     #PRJT2: [12, 9, 64]; exp_num(4), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [12, 9, 64]; exp_num(4), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #TOPN2: [11, 9, 64]; top_num(9)
</span></span><span style="display:flex;"><span>5           #RN: [11, 100000, 64]
</span></span><span style="display:flex;"><span>6             #BLKUP2: [11, 100000, 64]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>7               #SSCN: [11, 100000, 64]; IDX_TEST_LG1_A1(TEST_LG1); btr_scan(1); is_global(0)
</span></span></code></pre></div><p>对比计划可以发现，将 <code>SLCT2</code> 操作符改为了 <code>TOPN2</code>，并且下放到了 <code>PRJT2</code> 里面。</p>
<h3 id="值为-256">值为 256</h3>
<ul>
<li><input disabled="" type="checkbox"> 文档例子有问题</li>
</ul>
<p>当满足以下条件时，对相关派生表过滤条件进行下推优化：</p>
<ul>
<li>过滤条件对应派生表的查询项，并且是查询表达式；</li>
<li>过滤条件列映射为查询表达式的引用列，并且引用列来自派生表的 <code>FROM</code> 项；</li>
</ul>
<h3 id="值为-512">值为 512</h3>
<p>视图已经有过滤条件的，不重复下放，为了后续能使用 <code>htab</code>。</p>
<h3 id="值为-1024">值为 1024</h3>
<p>包含该值时，取消下述限制：</p>
<ul>
<li>视图是集合运算时的分支数应小于 10；</li>
<li>若视图是集合运算且超过 2 个分支时，过滤条件不能含有复杂函数/表达式；</li>
</ul>
<p>查看以下 SQL 执行计划</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="font-weight:bold">select</span>
</span></span><span style="display:flex;"><span>  <span style="font-style:italic">/*+view_filter_merging(0)*/</span>
</span></span><span style="display:flex;"><span>  *
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span>
</span></span><span style="display:flex;"><span>  (
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">union</span> <span style="font-weight:bold">all</span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">select</span> * <span style="font-weight:bold">from</span> test_lg1
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span><span style="font-weight:bold">where</span>
</span></span><span style="display:flex;"><span>  a1 &gt; 1;
</span></span></code></pre></div><p><code>VIEW_FILTER_MERGING = 0</code> 的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [850, 50000, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [850, 50000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #SLCT2: [850, 50000, 52]; DMTEMPVIEW_889193563.A1 &gt; 1
</span></span><span style="display:flex;"><span>4         #PRJT2: [817, 1000000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>5           #UNION ALL: [817, 1000000, 52]
</span></span><span style="display:flex;"><span>6             #PRJT2: [671, 900000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>7               #UNION ALL: [671, 900000, 52]
</span></span><span style="display:flex;"><span>8                 #PRJT2: [539, 800000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>9                   #UNION ALL: [539, 800000, 52]
</span></span><span style="display:flex;"><span>10                    #PRJT2: [422, 700000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>11                      #UNION ALL: [422, 700000, 52]
</span></span><span style="display:flex;"><span>12                        #PRJT2: [318, 600000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>13                          #UNION ALL: [318, 600000, 52]
</span></span><span style="display:flex;"><span>14                            #PRJT2: [229, 500000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>15                              #UNION ALL: [229, 500000, 52]
</span></span><span style="display:flex;"><span>16                                #PRJT2: [154, 400000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>17                                  #UNION ALL: [154, 400000, 52]
</span></span><span style="display:flex;"><span>18                                    #PRJT2: [92, 300000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>19                                      #UNION ALL: [92, 300000, 52]
</span></span><span style="display:flex;"><span>20                                        #PRJT2: [45, 200000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>21                                          #UNION ALL: [45, 200000, 52]
</span></span><span style="display:flex;"><span>22                                            #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>23                                              #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>24                                            #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>25                                              #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>26                                        #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>27                                          #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>28                                    #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>29                                      #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>30                                #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>31                                  #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>32                            #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>33                              #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>34                        #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>35                          #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>36                    #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>37                      #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>38                #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>39                  #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span><span style="display:flex;"><span>40            #PRJT2: [11, 100000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>41              #CSCN2: [11, 100000, 52]; INDEX33555467(TEST_LG1); btr_scan(1)
</span></span></code></pre></div><p>可以看出来，<code>SLCT2</code> 在 <code>PRJT2</code> 外层，也就是条件并没有下放。</p>
<p><code>VIEW_FILTER_MERGING = 1024</code> 的执行计划为</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>1   #NSET2: [93, 50000, 52]
</span></span><span style="display:flex;"><span>2     #PRJT2: [93, 50000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>3       #PRJT2: [93, 50000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>4         #UNION ALL: [93, 50000, 52]
</span></span><span style="display:flex;"><span>5           #PRJT2: [80, 45000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>6             #UNION ALL: [80, 45000, 52]
</span></span><span style="display:flex;"><span>7               #PRJT2: [68, 40000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>8                 #UNION ALL: [68, 40000, 52]
</span></span><span style="display:flex;"><span>9                   #PRJT2: [57, 35000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>10                    #UNION ALL: [57, 35000, 52]
</span></span><span style="display:flex;"><span>11                      #PRJT2: [47, 30000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>12                        #UNION ALL: [47, 30000, 52]
</span></span><span style="display:flex;"><span>13                          #PRJT2: [37, 25000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>14                            #UNION ALL: [37, 25000, 52]
</span></span><span style="display:flex;"><span>15                              #PRJT2: [28, 20000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>16                                #UNION ALL: [28, 20000, 52]
</span></span><span style="display:flex;"><span>17                                  #PRJT2: [19, 15000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>18                                    #UNION ALL: [19, 15000, 52]
</span></span><span style="display:flex;"><span>19                                      #PRJT2: [12, 10000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>20                                        #UNION ALL: [12, 10000, 52]
</span></span><span style="display:flex;"><span>21                                          #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>22                                            #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>23                                              #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>24                                          #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>25                                            #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>26                                              #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>27                                      #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>28                                        #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>29                                          #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>30                                  #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>31                                    #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>32                                      #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>33                              #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>34                                #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>35                                  #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>36                          #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>37                            #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>38                              #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>39                      #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>40                        #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>41                          #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>42                  #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>43                    #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>44                      #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>45              #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>46                #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>47                  #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span><span style="display:flex;"><span>48          #PRJT2: [5, 5000, 52]; exp_num(2), is_atom(FALSE)
</span></span><span style="display:flex;"><span>49            #BLKUP2: [5, 5000, 52]; IDX_TEST_LG1_A1(TEST_LG1)
</span></span><span style="display:flex;"><span>50              #SSEK2: [5, 5000, 52]; scan_type(ASC), IDX_TEST_LG1_A1(TEST_LG1), scan_range(1,max], is_global(0)
</span></span></code></pre></div><p>这就可以看到 <code>SLCT2</code> 被下放到每一个查询里面，变成了索引范围查询了。</p>

        </div>

        <div class="row middle-xs">
          <div class="col-xs-12">
            
          </div>
        </div>
        
          <div class="row">
            <div class="col-xs-12">
              
            </div>
          </div>

          



          
          
          <div style="height: 50px;"></div>
          
        

        <div class="site-footer">
  
  
</div>

      </div>
    </div>
  </article>

  
<script>
  
  document.addEventListener("DOMContentLoaded", function() {
    const disqus = document.getElementById('disqus_thread');
    if (!disqus) {
      return;
    }
    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        const iframes = disqus.getElementsByTagName('iframe');
        if (iframes.length > 1) {
          const commentsIframe = iframes[1];
          while (disqus.firstChild) {
            disqus.removeChild(disqus.firstChild);
          }
          disqus.appendChild(commentsIframe);
          observer.disconnect();
        }
      });
    });
    observer.observe(disqus, { childList: true, subtree: true });
  });
</script>

  

</body>

</html>